# Migration `20201015191612-init`

This migration has been generated by János Fehér at 10/15/2020, 9:16:12 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."orderstatus" AS ENUM ('LATE', 'PENDING', 'RENTED', 'RETURNED')

CREATE TYPE "public"."userrole" AS ENUM ('ADMIN', 'BASIC', 'EDITOR')

CREATE TABLE "public"."Book" (
"author" text   ,
"count" integer   ,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"image" text   ,
"isbn" text   ,
"notes" text   ,
"publishedAt" integer   ,
"publisher" text   ,
"stockCount" integer   ,
"title" text   ,
"updatedAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."BookToCart" (
"bookId" integer   NOT NULL ,
"cartId" integer   NOT NULL ,
"id" SERIAL,
"quantity" integer   DEFAULT 1,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."BookToOrder" (
"bookId" integer   NOT NULL ,
"id" SERIAL,
"orderId" integer   NOT NULL ,
"quantity" integer   DEFAULT 1,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Cart" (
"id" integer   NOT NULL ,
"userId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Category" (
"id" SERIAL,
"name" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Comment" (
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"orderId" integer   ,
"text" text   ,
"userId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Order" (
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"returnDate" timestamp(3)   ,
"status" "orderstatus"  DEFAULT E'PENDING',
"updatedAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"userId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."User" (
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"email" text   ,
"id" SERIAL,
"name" text   ,
"password" text   ,
"role" "userrole"  DEFAULT E'BASIC',
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_BookToCategory" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE UNIQUE INDEX "Book.isbn_unique" ON "public"."Book"("isbn")

CREATE UNIQUE INDEX "Order.userId_unique" ON "public"."Order"("userId")

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "_BookToCategory_AB_unique" ON "public"."_BookToCategory"("A", "B")

CREATE INDEX "_BookToCategory_B_index" ON "public"."_BookToCategory"("B")

ALTER TABLE "public"."BookToCart" ADD FOREIGN KEY ("bookId")REFERENCES "public"."Book"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."BookToCart" ADD FOREIGN KEY ("cartId")REFERENCES "public"."Cart"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."BookToOrder" ADD FOREIGN KEY ("bookId")REFERENCES "public"."Book"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."BookToOrder" ADD FOREIGN KEY ("orderId")REFERENCES "public"."Order"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Order" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_BookToCategory" ADD FOREIGN KEY ("A")REFERENCES "public"."Book"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_BookToCategory" ADD FOREIGN KEY ("B")REFERENCES "public"."Category"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201015191612-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,98 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+enum orderstatus {
+  LATE
+  PENDING
+  RENTED
+  RETURNED
+}
+
+enum userrole {
+  ADMIN
+  BASIC
+  EDITOR
+}
+
+model Book {
+  author      String?
+  count       Int?
+  createdAt   DateTime?     @default(now())
+  id          Int           @default(autoincrement()) @id
+  image       String?
+  isbn        String?       @unique
+  notes       String?
+  publishedAt Int?
+  publisher   String?
+  stockCount  Int?
+  title       String?
+  updatedAt   DateTime?     @default(now())
+  carts       BookToCart[]
+  orders      BookToOrder[]
+  categories  Category[]
+}
+
+model BookToCart {
+  bookId   Int
+  cartId   Int
+  id       Int  @default(autoincrement()) @id
+  quantity Int? @default(1)
+  book     Book @relation(fields: [bookId], references: [id])
+  cart     Cart @relation(fields: [cartId], references: [id])
+}
+
+model BookToOrder {
+  bookId   Int
+  id       Int   @default(autoincrement()) @id
+  orderId  Int
+  quantity Int?  @default(1)
+  book     Book  @relation(fields: [bookId], references: [id])
+  order    Order @relation(fields: [orderId], references: [id])
+}
+
+model Cart {
+  id         Int          @id
+  userId     Int?
+  books      BookToCart[]
+}
+
+model Category {
+  id   Int     @default(autoincrement()) @id
+  name String?
+  books Book[]
+}
+
+model Comment {
+  createdAt DateTime? @default(now())
+  id        Int       @default(autoincrement()) @id
+  orderId   Int?
+  text      String?
+  userId    Int?
+}
+
+model Order {
+  createdAt   DateTime?     @default(now())
+  id          Int           @default(autoincrement()) @id
+  returnDate  DateTime?
+  status      orderstatus?  @default(PENDING)
+  updatedAt   DateTime?     @default(now())
+  userId      Int           @unique
+  user        User          @relation(fields: [userId], references: [id])
+  books       BookToOrder[]
+}
+
+model User {
+  createdAt DateTime? @default(now())
+  email     String?   @unique
+  id        Int       @default(autoincrement()) @id
+  name      String?
+  password  String?
+  role      userrole? @default(BASIC)
+  orders    Order[]
+}
```


